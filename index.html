<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vínculo Financeiro - Gestão Inteligente</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap');
        
        :root {
            --bg-dark: #050505;
            --card-dark: #121212;
            --border-dark: #1f1f1f;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-dark);
            color: #f4f4f5;
            margin: 0;
            overflow-x: hidden;
        }

        /* Efeito Bolha nos Cards */
        .bubble-card {
            background: linear-gradient(145deg, #161616, #0d0d0d);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 28px;
            box-shadow: 0 20px 50px -15px rgba(0, 0, 0, 0.7), inset 0 1px 1px rgba(255, 255, 255, 0.08);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .bubble-card:hover {
            transform: translateY(-4px);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .tab-active {
            color: #60a5fa;
            border-bottom: 3px solid #60a5fa;
        }

        input, select {
            background-color: #1a1a1a !important;
            border: 1px solid #2d2d2d !important;
            color: white !important;
            transition: all 0.2s ease;
        }

        input:focus, select:focus {
            border-color: #3b82f6 !important;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.15) !important;
            transform: scale(1.005);
        }

        .auth-screen {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle at top right, #1e1b4b, #050505);
        }

        .profile-img-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #3b82f6;
            margin: 0 auto;
            display: block;
        }

        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        
        .hidden { display: none !important; }
    </style>
</head>
<body class="pb-20">

    <!-- Tela de Autenticação -->
    <div id="auth-container" class="auth-screen p-4">
        <div class="bubble-card p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <div class="inline-block p-4 bg-blue-600 rounded-2xl shadow-xl shadow-blue-900/40 mb-4">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
                </div>
                <h2 id="auth-title" class="text-2xl font-extrabold text-white">Bem-vindo de volta</h2>
                <p id="auth-subtitle" class="text-zinc-500 text-sm mt-2">Acesse sua conta para gerenciar suas finanças</p>
            </div>

            <!-- Formulário de Cadastro (Oculto inicialmente) -->
            <div id="signup-fields" class="hidden space-y-4 mb-4">
                <div class="relative group">
                    <input type="file" id="photo-input" accept="image/*" class="hidden" onchange="previewPhoto(event)">
                    <div onclick="document.getElementById('photo-input').click()" class="cursor-pointer">
                        <img id="img-preview" src="https://ui-avatars.com/api/?name=User&background=333&color=fff" class="profile-img-preview mb-2">
                        <p class="text-[10px] text-center text-blue-500 font-bold uppercase tracking-widest">Alterar Foto</p>
                    </div>
                </div>
                <div class="space-y-1">
                    <label class="text-[10px] text-zinc-500 ml-2 font-black uppercase tracking-widest">Nome Completo</label>
                    <input type="text" id="reg-name" class="w-full p-4 rounded-2xl outline-none">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-1">
                        <label class="text-[10px] text-zinc-500 ml-2 font-black uppercase tracking-widest">CPF</label>
                        <input type="text" id="reg-cpf" placeholder="000.000.000-00" class="w-full p-4 rounded-2xl outline-none">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] text-zinc-500 ml-2 font-black uppercase tracking-widest">Telefone</label>
                        <input type="text" id="reg-phone" placeholder="(00) 00000-0000" class="w-full p-4 rounded-2xl outline-none">
                    </div>
                </div>
            </div>

            <!-- Campos Comuns -->
            <div class="space-y-4">
                <div class="space-y-1">
                    <label class="text-[10px] text-zinc-500 ml-2 font-black uppercase tracking-widest">E-mail ou Telefone</label>
                    <input type="text" id="auth-login" class="w-full p-4 rounded-2xl outline-none">
                </div>
                <div class="space-y-1">
                    <label class="text-[10px] text-zinc-500 ml-2 font-black uppercase tracking-widest">Senha</label>
                    <input type="password" id="auth-pass" class="w-full p-4 rounded-2xl outline-none">
                </div>
                
                <button onclick="handleAuth()" id="btn-auth" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-black py-4 rounded-2xl shadow-lg shadow-blue-900/20 transition-all uppercase text-xs tracking-widest mt-4">
                    Entrar
                </button>
            </div>

            <div class="text-center mt-8">
                <p id="auth-toggle-text" class="text-zinc-500 text-xs">
                    Não tem uma conta? 
                    <button onclick="toggleAuthMode()" class="text-blue-500 font-bold hover:underline">Cadastre-se</button>
                </p>
            </div>
        </div>
    </div>

    <!-- Interface Principal (Oculta até login) -->
    <div id="main-app" class="hidden">
        <header class="p-6 border-b border-zinc-900 bg-black/40 backdrop-blur-xl sticky top-0 z-50">
            <div class="max-w-4xl mx-auto flex justify-between items-center">
                <div class="flex items-center gap-4">
                    <img id="user-avatar" src="" class="w-12 h-12 rounded-full border-2 border-blue-600 object-cover">
                    <div>
                        <h1 class="text-lg font-extrabold tracking-tight text-white flex items-center gap-2">
                            Olá, <span id="user-name-display">Usuário</span>
                        </h1>
                        <p id="current-date-display" class="text-zinc-500 text-[10px] font-bold uppercase tracking-widest"></p>
                    </div>
                </div>
                <button onclick="logout()" class="text-[10px] text-zinc-500 hover:text-rose-500 uppercase font-bold transition-colors">Sair</button>
            </div>
        </header>

        <main class="max-w-4xl mx-auto p-4 mt-6">
            <div class="flex gap-8 mb-8 border-b border-zinc-900 px-2">
                <button onclick="switchTab('monthly')" id="tab-monthly" class="pb-4 font-bold tab-active transition-all">Visão Mensal</button>
                <button onclick="switchTab('yearly')" id="tab-yearly" class="pb-4 font-bold text-zinc-600 hover:text-zinc-400 transition-all">Análise Anual</button>
            </div>

            <!-- Mesmos cards e tabelas da versão anterior -->
            <section id="section-monthly" class="space-y-8">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bubble-card p-6 border-l-4 border-emerald-500/50">
                        <span class="text-zinc-500 text-[10px] font-black uppercase block mb-2 tracking-tighter">Entradas</span>
                        <p id="display-income" class="text-3xl font-bold text-white">R$ 0,00</p>
                    </div>
                    <div class="bubble-card p-6 border-l-4 border-rose-500/50">
                        <span class="text-zinc-500 text-[10px] font-black uppercase block mb-2 tracking-tighter">Saídas</span>
                        <p id="display-expenses" class="text-3xl font-bold text-white">R$ 0,00</p>
                    </div>
                    <div class="bubble-card p-6 border-l-4 border-blue-500/50">
                        <span class="text-zinc-500 text-[10px] font-black uppercase block mb-2 tracking-tighter">Líquido</span>
                        <p id="display-balance" class="text-3xl font-bold text-white">R$ 0,00</p>
                    </div>
                </div>

                <div class="bubble-card p-8" id="form-container">
                    <h3 id="form-title" class="text-lg font-bold mb-6 flex items-center gap-2 italic">
                        <span class="w-2 h-2 bg-blue-500 rounded-full shadow-[0_0_10px_rgba(59,130,246,0.5)]"></span>
                        Novo Lançamento
                    </h3>
                    <!-- Conteúdo do formulário mantido... -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="space-y-2">
                            <label class="text-[10px] text-zinc-500 ml-2 font-black uppercase tracking-widest">Descrição</label>
                            <input type="text" id="desc-input" class="w-full p-4 rounded-2xl outline-none">
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] text-zinc-500 ml-2 font-black uppercase tracking-widest">Valor</label>
                            <input type="number" id="value-input" step="0.01" class="w-full p-4 rounded-2xl outline-none">
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] text-zinc-500 ml-2 font-black uppercase tracking-widest">Classificação</label>
                            <select id="type-input" class="w-full p-4 rounded-2xl outline-none cursor-pointer">
                                <option value="Renda">Renda</option>
                                <option value="Despesa Fixa">Despesa Fixa</option>
                                <option value="Despesa Variavel">Despesa Variável</option>
                                <option value="Investimento">Investimento</option>
                                <option value="Poupança">Poupança</option>
                            </select>
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] text-zinc-500 ml-2 font-black uppercase tracking-widest">Mês de Início</label>
                            <select id="start-month-input" class="w-full p-4 rounded-2xl outline-none"></select>
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] text-zinc-500 ml-2 font-black uppercase tracking-widest">Recorrência</label>
                            <select id="recurrence-input" onchange="toggleParcelInput()" class="w-full p-4 rounded-2xl outline-none">
                                <option value="unico">Mês atual</option>
                                <option value="fixo">Mensal (Fixo)</option>
                                <option value="parcelado">Parcelado</option>
                            </select>
                        </div>
                        <div id="parcel-container" class="space-y-2 hidden">
                            <label class="text-[10px] text-zinc-500 ml-2 font-black uppercase tracking-widest">Parcelas</label>
                            <input type="number" id="installments-input" class="w-full p-4 rounded-2xl outline-none">
                        </div>
                        <div class="lg:col-span-3 mt-4">
                            <button onclick="addEntry()" id="btn-submit" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-black py-4 rounded-2xl shadow-lg shadow-blue-900/20 transition-all uppercase text-xs tracking-widest">
                                Salvar Lançamento
                            </button>
                        </div>
                    </div>
                </div>

                <div class="bubble-card p-8">
                    <div class="flex flex-col sm:flex-row justify-between items-center mb-8 gap-4">
                        <h3 class="text-lg font-bold">Histórico do Mês</h3>
                        <select onchange="changeFilterMonth(this.value)" id="month-filter" class="text-xs p-3 rounded-xl bg-zinc-800 font-bold outline-none border-none appearance-none cursor-pointer px-6"></select>
                    </div>
                    <div class="overflow-x-auto custom-scroll">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="text-zinc-500 text-[10px] uppercase border-b border-zinc-800/50 font-black tracking-widest">
                                    <th class="pb-4">Descrição</th>
                                    <th class="pb-4">Categoria</th>
                                    <th class="pb-4 text-right">Valor</th>
                                    <th class="pb-4 text-right">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="transaction-history"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section id="section-yearly" class="hidden space-y-8">
                <div class="bubble-card p-10 h-96">
                    <canvas id="yearlyChart"></canvas>
                </div>
            </section>
        </main>
    </div>

    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-zinc-900 border border-zinc-800 p-5 rounded-3xl shadow-2xl opacity-0 transition-all z-[100] flex items-center gap-4 pointer-events-none">
        <div id="toast-icon" class="w-1.5 h-10 bg-blue-500 rounded-full"></div>
        <p id="toast-text" class="font-bold text-sm text-white"></p>
    </div>

    <script>
        let isSignup = false;
        let currentUser = null;
        let transactions = [];
        let profilePhoto = null;
        let selectedMonth = new Date().getMonth();
        let selectedYear = 2026;
        let chartInstance = null;

        const months = ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];

        // Autenticação
        function toggleAuthMode() {
            isSignup = !isSignup;
            const title = document.getElementById('auth-title');
            const subtitle = document.getElementById('auth-subtitle');
            const btn = document.getElementById('btn-auth');
            const toggleText = document.getElementById('auth-toggle-text');
            const signupFields = document.getElementById('signup-fields');

            if(isSignup) {
                title.innerText = "Crie sua conta";
                subtitle.innerText = "Comece a organizar sua vida financeira hoje";
                btn.innerText = "Criar Conta";
                toggleText.innerHTML = 'Já tem uma conta? <button onclick="toggleAuthMode()" class="text-blue-500 font-bold hover:underline">Entre aqui</button>';
                signupFields.classList.remove('hidden');
            } else {
                title.innerText = "Bem-vindo de volta";
                subtitle.innerText = "Acesse sua conta para gerenciar suas finanças";
                btn.innerText = "Entrar";
                toggleText.innerHTML = 'Não tem uma conta? <button onclick="toggleAuthMode()" class="text-blue-500 font-bold hover:underline">Cadastre-se</button>';
                signupFields.classList.add('hidden');
            }
        }

        function previewPhoto(event) {
            const reader = new FileReader();
            reader.onload = function() {
                profilePhoto = reader.result;
                document.getElementById('img-preview').src = reader.result;
            }
            reader.readAsDataURL(event.target.files[0]);
        }

        function handleAuth() {
            const login = document.getElementById('auth-login').value;
            const pass = document.getElementById('auth-pass').value;

            if(!login || !pass) return showToast("Preencha todos os campos!", "error");

            if(isSignup) {
                const name = document.getElementById('reg-name').value;
                const cpf = document.getElementById('reg-cpf').value;
                const phone = document.getElementById('reg-phone').value;

                if(!name || !cpf) return showToast("Dados de perfil obrigatórios!", "error");

                currentUser = { 
                    name, login, cpf, phone, 
                    photo: profilePhoto || `https://ui-avatars.com/api/?name=${name}&background=random` 
                };
                localStorage.setItem('user_session', JSON.stringify(currentUser));
                showToast("Conta criada com sucesso!");
            } else {
                // Simulação simples de login
                const stored = localStorage.getItem('user_session');
                if(stored) {
                    const user = JSON.parse(stored);
                    if(user.login === login) {
                        currentUser = user;
                    } else {
                        return showToast("Usuário não encontrado!", "error");
                    }
                } else {
                    return showToast("Nenhum usuário cadastrado!", "error");
                }
            }
            
            enterApp();
        }

        function enterApp() {
            document.getElementById('auth-container').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            document.getElementById('user-name-display').innerText = currentUser.name.split(' ')[0];
            document.getElementById('user-avatar').src = currentUser.photo;
            initApp();
        }

        function logout() {
            currentUser = null;
            document.getElementById('auth-container').classList.remove('hidden');
            document.getElementById('main-app').classList.add('hidden');
        }

        // Lógica da Aplicação (Herdada e Ajustada)
        function initApp() {
            const stored = localStorage.getItem(`tx_${currentUser.login}`);
            transactions = stored ? JSON.parse(stored) : [];
            initFilters();
            updateDisplayDate();
            renderMonthly();
        }

        function initFilters() {
            const filter = document.getElementById('month-filter');
            const startMonth = document.getElementById('start-month-input');
            filter.innerHTML = "";
            startMonth.innerHTML = "";
            months.forEach((m, i) => {
                const opt = document.createElement('option');
                opt.value = i; opt.innerText = m;
                if(i === selectedMonth) opt.selected = true;
                filter.appendChild(opt.cloneNode(true));
                startMonth.appendChild(opt);
            });
        }

        function toggleParcelInput() {
            const recurrence = document.getElementById('recurrence-input').value;
            document.getElementById('parcel-container').classList.toggle('hidden', recurrence !== 'parcelado');
        }

        function updateDisplayDate() {
            document.getElementById('current-date-display').innerText = `${months[selectedMonth]} ${selectedYear}`;
        }

        function changeFilterMonth(m) {
            selectedMonth = parseInt(m);
            updateDisplayDate();
            renderMonthly();
        }

        function addEntry() {
            const desc = document.getElementById('desc-input').value;
            const val = parseFloat(document.getElementById('value-input').value);
            const type = document.getElementById('type-input').value;
            const startMonth = parseInt(document.getElementById('start-month-input').value);
            const recurrence = document.getElementById('recurrence-input').value;
            const inst = parseInt(document.getElementById('installments-input').value) || 1;

            if(!desc || isNaN(val)) return showToast("Dados inválidos!", "error");

            const groupId = Math.random().toString(36).substr(2, 9);
            
            if(recurrence === 'unico') {
                transactions.push({ id: Math.random().toString(36).substr(2, 9), description: desc, value: val, type, month: startMonth, year: selectedYear });
            } else if(recurrence === 'fixo') {
                for(let m = startMonth; m < 12; m++) {
                    transactions.push({ id: Math.random().toString(36).substr(2, 9), groupId, description: desc, value: val, type, month: m, year: selectedYear, recurrence: 'fixo' });
                }
            } else {
                for(let i=0; i<inst; i++) {
                    let m = startMonth + i; let y = selectedYear;
                    if(m > 11) { m %= 12; y++; }
                    if(y > selectedYear) break;
                    transactions.push({ id: Math.random().toString(36).substr(2, 9), groupId, description: `${desc} (${i+1}/${inst})`, value: val, type, month: m, year: y });
                }
            }

            save();
            clearInputs();
            renderMonthly();
            showToast("Lançado!");
        }

        function renderMonthly() {
            const data = transactions.filter(t => t.month === selectedMonth && t.year === selectedYear);
            let inc = 0, exp = 0;
            const tbody = document.getElementById('transaction-history');
            tbody.innerHTML = "";

            data.forEach(t => {
                const isRenda = t.type === 'Renda';
                if(isRenda) inc += t.value; else exp += t.value;

                tbody.innerHTML += `
                    <tr class="border-b border-zinc-900/50 hover:bg-zinc-800/30 group transition-colors">
                        <td class="py-5 font-bold text-zinc-100">${t.description}</td>
                        <td class="py-5"><span class="px-2 py-1 rounded-lg text-[9px] font-black uppercase bg-zinc-800 text-zinc-400">${t.type}</span></td>
                        <td class="py-5 text-right font-mono font-bold ${isRenda ? 'text-emerald-400' : 'text-rose-400'}">R$ ${t.value.toLocaleString('pt-BR')}</td>
                        <td class="py-5 text-right opacity-0 group-hover:opacity-100 transition-opacity">
                            <button onclick="deleteTx('${t.id}')" class="text-zinc-600 hover:text-rose-500 text-[10px] font-black uppercase">Remover</button>
                        </td>
                    </tr>
                `;
            });

            document.getElementById('display-income').innerText = `R$ ${inc.toLocaleString('pt-BR')}`;
            document.getElementById('display-expenses').innerText = `R$ ${exp.toLocaleString('pt-BR')}`;
            document.getElementById('display-balance').innerText = `R$ ${(inc-exp).toLocaleString('pt-BR')}`;
        }

        function deleteTx(id) {
            transactions = transactions.filter(t => t.id !== id);
            save();
            renderMonthly();
        }

        function save() { localStorage.setItem(`tx_${currentUser.login}`, JSON.stringify(transactions)); }
        function clearInputs() { 
            document.getElementById('desc-input').value = ""; 
            document.getElementById('value-input').value = "";
        }

        function switchTab(tab) {
            document.getElementById('section-monthly').classList.toggle('hidden', tab !== 'monthly');
            document.getElementById('section-yearly').classList.toggle('hidden', tab !== 'yearly');
            document.getElementById('tab-monthly').classList.toggle('tab-active', tab === 'monthly');
            document.getElementById('tab-yearly').classList.toggle('tab-active', tab === 'yearly');
            if(tab === 'yearly') renderYearly();
        }

        function renderYearly() {
            const ctx = document.getElementById('yearlyChart').getContext('2d');
            const dataSet = months.map((_, i) => {
                const monthItems = transactions.filter(t => t.month === i && t.year === selectedYear);
                return monthItems.filter(t => t.type === 'Renda').reduce((s,t) => s+t.value, 0) - 
                       monthItems.filter(t => t.type !== 'Renda').reduce((s,t) => s+t.value, 0);
            });

            if(chartInstance) chartInstance.destroy();
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months.map(m => m.substring(0,3)),
                    datasets: [{
                        label: 'Saldo Mensal',
                        data: dataSet,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59,130,246,0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });
        }

        function showToast(msg, type = "success") {
            const t = document.getElementById('toast');
            document.getElementById('toast-text').innerText = msg;
            t.style.opacity = "1";
            setTimeout(() => t.style.opacity = "0", 3000);
        }

        // Auto-login se houver sessão
        window.onload = () => {
            const savedUser = localStorage.getItem('user_session');
            if(savedUser) {
                currentUser = JSON.parse(savedUser);
                enterApp();
            }
        };
    </script>
</body>
</html>
